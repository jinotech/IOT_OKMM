ScaleAnimate=(function(){function u(){}var r=0;var f=30;var n=null;var h=null;var b=0;var a=0;var c=5000;var l=3000;var g=0;var t=0;var p=0;var o=0;var s=false;var w=false;var j=false;var k=0;var q=null;var v=null;var m=function(B){var z={};var y="rotate matrix translate scale skewX skewY".split(" ");for(var A=0;A<y.length;A++){var C=new RegExp(y[A]+"[(]([^)]*)[)]","ig");var x=C.exec(B);z[y[A]]=x?x[1]:null}return z};var e=function(z,B,C,A){var x=B+","+C+","+A;var F=null;var I=[];var H=z.groupEl.getAttribute("transform");F=m(H);F.rotate=x;I=[];for(var G in F){if(F[G]){I.push(G+"("+F[G]+")")}}z.groupEl.setAttribute("transform",I.join(" "));if(z.connection){var E=z.connection.line.node.getAttribute("transform");F=m(E);F.rotate=x;I=[];for(var G in F){if(F[G]){I.push(G+"("+F[G]+")")}}z.connection.line.node.setAttribute("transform",I.join(" "))}if(z.getChildren().length>0){var y=z.getChildren();for(var D=0;D<y.length;D++){e(y[D],B,C,A)}}};var d=function(){v=$('<div class="pt-navi-container"></div>');$nextArea=$('<div class="pt-next-area"></div>');$prevArea=$('<div class="pt-prev-area"></div>');$naviNext=$('<span class="pt-arrows-next" title="Next"></span>');$naviPrev=$('<span class="pt-arrows-prev" title="Prev"></span>');$prevArea.mouseover(function(){$naviPrev.fadeIn("slow")}).mouseout(function(){$naviPrev.fadeOut("slow")}).click(function(){u.prevShow(30)});$nextArea.mouseover(function(){$naviNext.fadeIn("slow")}).mouseout(function(){$naviNext.fadeOut("slow")}).click(function(){u.nextShow(30)});v.append($nextArea);v.append($prevArea);v.append($naviNext);v.append($naviPrev);$(document.body).append(v)};var i=function(x){var y=function(B,A){return'<a id="'+B+'" class="gh-btn"><span id="'+B+'-text" class="gh-text">'+A+"</span></a>"};q=$('<span id="jmpress-btn-box" class="jmpress-btn"></span>');var z=$(y("jmpress-close0-btn","Close"));z.click(function(){u.endShowMode()});q.append(z);q.appendTo($(document.body))};u.startShowMode=function(z,A,y){EditorManager.hide();d();i();if(A){r=A}if(z){f=z}jMap.work.scrollTop=0;jMap.work.scrollLeft=0;jMap.enableDragPaper(false);s=true;if(!y){k=0}var x=EditorManager.getPresentationElement(k).node;if(!u.showStyle){u.showStyle=u.scaleToScreenFit}u.showStyle(x)};u.endShowMode=function(){var y=window.location.href;if(y.indexOf("/show/map/")>0){y=y.replace("/show/map/","/map/");window.location.replace(y);return}q.remove();v.remove();jMap.enableDragPaper(true);var x=jMap.work;x.scrollLeft=Math.round((x.scrollWidth-x.offsetWidth)/2);x.scrollTop=Math.round((x.scrollHeight-x.offsetHeight)/2);RAPHAEL.canvas.removeAttribute("viewBox");s=false;jMap.work.focus()};u.isShowMode=function(){return s};u.nextShow=function(y){if(!s||j||EditorManager.getSequenceSize()<=k+1){return}k++;var x=EditorManager.getPresentationElement(k).node;u.showStyle(x,y)};u.prevShow=function(y){if(!s||j||0>=k){return}k--;var x=EditorManager.getPresentationElement(k).node;u.showStyle(x,y)};u.scaleToScreenFit=function(W,R){if(Raphael.svg&&!j&&s){if(!W){W=jMap.getRootNode()}if(!R){R=1}var B=RAPHAEL.getSize();var ad=1;var U=(W.getTreeWidth()+r)/jMap.work.clientWidth;var Y=(W.getTreeHeight()+r)/jMap.work.clientHeight;var P=true;if(U>Y){P=true;ad=U}else{P=false;ad=Y}var Q=B.width*ad;var aa=B.height*ad;var O=W.getLocation().x;var N=W.getLocation().y;if(W.isLeft&&W.isLeft()){O=O-W.getTreeWidth();O=O+W.getSize().width;O=O-(r/2)}else{O=O-(r/2)}if(P){N=N-(jMap.work.clientHeight/2)*ad;N=N+(W.getSize().height/2)*ad}else{var ac=function(y,x){x=Math.min(y.getLocation().y,x);if(y.getChildren().length>0){x=ac(y.getChildren()[0],x)}return x};N=ac(W,N);N=N-(r/2)}var ae=(O-b)/R;var K=b;b=O;var D=(N-a)/R;var J=a;a=N;var ab=(Q-c)/R;var L=c;c=Q;var T=(aa-l)/R;var S=l;l=aa;var Z=0;var E=W.getLocation().x+(W.getTreeWidth()/2);var C=W.getLocation().y+(W.getTreeHeight()/2);var M=W.groupEl.getAttribute("transform");transformations=m(M);var X=null;if(transformations.rotate){X=transformations.rotate.split(",");Z=X[0]}var G=0-Z-t;var A=G/R;var z=(E-p)/R;var I=p;p=E;var H=(C-o)/R;var F=o;o=C;var V=new TimeLine(f,R);V.onframe=function(){K=K+ae;J=J+D;L=L+ab;S=S+T;var x=K+" "+J+" "+L+" "+S;RAPHAEL.canvas.setAttribute("viewBox",x);if(A){t=t+A;I=I+z;F=F+H;u.globalRotate(Math.floor(t),I,F)}};V.onstart=function(){j=true};V.onstop=function(){j=false;W.focus(true)};V.start()}};u.scaleToScreenFitWithZoomInOut=function(U,Q){if(Raphael.svg&&!j&&s){if(!U){U=jMap.getRootNode()}if(!Q){Q=1}var C=RAPHAEL.getSize();var ab=1;var R=(U.getTreeWidth()+r)/jMap.work.clientWidth;var W=(U.getTreeHeight()+r)/jMap.work.clientHeight;var O=true;if(R>W){O=true;ab=R}else{O=false;ab=W}var P=C.width*ab;var Z=C.height*ab;var N=U.getLocation().x;var M=U.getLocation().y;if(U.isLeft&&U.isLeft()){N=N-U.getTreeWidth();N=N+U.getSize().width;N=N-(r/2)}else{N=N-(r/2)}if(O){M=M-(jMap.work.clientHeight/2)*ab;M=M+(U.getSize().height/2)*ab}else{var aa=function(y,x){x=Math.min(y.getLocation().y,x);if(y.getChildren().length>0){x=aa(y.getChildren()[0],x)}return x};M=aa(U,M);M=M-(r/2)}var Y=0;if(U.isLeft&&U.isLeft()){var E=U.getLocation().x-(U.getTreeWidth()/2);var D=U.getLocation().y-(U.getTreeHeight()/2)}else{var E=U.getLocation().x+(U.getTreeWidth()/2);var D=U.getLocation().y+(U.getTreeHeight()/2)}var K=U.groupEl.getAttribute("transform");transformations=m(K);var V=null;if(transformations.rotate){V=transformations.rotate.split(",");Y=V[0]}var H=0-Y-t;var B=H/Q;var A=(E-p)/Q;var J=p;p=E;var I=(D-o)/Q;var G=o;o=D;var S=new TimeLine(f,Q);var L=1;var T=1;var F=1;var X=1;var z=1;S.onframe=function(){F=X*L*L+z*L;var y=L/Q;rw=c+(P-c)*F;rh=l+(Z-l)*F;rx=(1-y)*(1-y)*b+2*(1-y)*y*jMap.work.clientWidth/2+N*y*y;ry=(1-y)*(1-y)*a+2*(1-y)*y*jMap.work.clientHeight/2+M*y*y;rw=(rw>=0)?rw:0;rh=(rh>=0)?rh:0;rx=(rx>=0)?rx:0;ry=(ry>=0)?ry:0;var x=rx+" "+ry+" "+rw+" "+rh;RAPHAEL.canvas.setAttribute("viewBox",x);if(B){t=t+B;J=J+A;G=G+I;u.globalRotate(Math.floor(t),J,G)}L++};S.onstart=function(){j=true;CC=Math.min(c,P);T=3*jMap.work.clientWidth/(P-c);z=(4*T-1)/Q;X=(4*T-2*z*Q)/(Q*Q)};S.onstop=function(){j=false;U.focus(true);b=N+0.1;a=M+0.1;c=P+0.1;l=Z+0.1};S.start()}};u.rotate=function(y,z,x,A){e(y,z,x,A)};u.globalRotate=function(D,z,E){var C=D+","+z+","+E;var B=null;var A=[];var y=jMap.groupEl.getAttribute("transform");B=m(y);B.rotate=C;A=[];for(var x in B){if(B[x]){A.push(x+"("+B[x]+")")}}jMap.groupEl.setAttribute("transform",A.join(" "))};u.tempRotate=function(B){var D=30;var y=360;if(B.isLeft&&B.isLeft()){var x=B.getLocation().x-(B.getTreeWidth()/2)+B.getSize().width;var E=B.getLocation().y+(B.getTreeHeight()/2)}else{if((B.getLocation().x==jMap.getRootNode().getLocation().x)&(B.getLocation().y==jMap.getRootNode().getLocation().y)){var x=B.getLocation().x+(B.getSize().width/2);var E=B.getLocation().y+(B.getSize().height/2)}else{var x=B.getLocation().x+(B.getTreeWidth()/2);var E=B.getLocation().y+(B.getTreeHeight()/2)}}var A=0;var z=y/D;var C=new TimeLine(f,D);C.onframe=function(){A=A+z;u.rotate(B,Math.floor(A),x,E)};C.onstart=function(){};C.onstop=function(){};C.start()};AnimateController=function(){document.onkeydown=function(x){x=x||window.event;if(jMap.work.hasFocus()){return false}return true};jMap.work.onkeydown=this.keyDown;jMap.work.ondragenter=function(x){x=x||window.event;if(x.preventDefault){x.preventDefault()}else{x.returnValue=false}};jMap.work.ondragover=function(x){x=x||window.event;if(x.preventDefault){x.preventDefault()}else{x.returnValue=false}};jMap.work.ondrop=function(x){x=x||window.event;if(x.preventDefault){x.preventDefault()}else{x.returnValue=false}}};AnimateController.prototype.type="AnimateController";AnimateController.prototype.keyDown=function(x){x=x||window.event;var C=null;if(x){C=x.ctrlKey}else{if(x&&document.getElementById){C=(Event.META_MASK||Event.CTRL_MASK)}else{if(x&&document.layers){C=(x.metaKey||x.ctrlKey)}}}var D=x.altKey;var B=x.keyCode;switch(B){case 8:u.prevShow(30);break;case 13:u.nextShow(30);break;case 37:var A=jMap.getSelecteds().getLastElement();switch(jMap.layoutManager.type){case"jMindMapLayout":if(A.isRootNode()){var z=A.getChildren();for(var y=0;y<z.length;y++){if(z[y].position=="left"){z[y].focus(true);break}}}else{if(A.isLeft()){jMap.controller.childNodeFocusAction(A)}else{jMap.controller.parentNodeFocusAction(A)}}break;case"jTreeLayout":jMap.controller.prevSiblingNodeFocusAction(A);break;default:}break;case 38:var A=jMap.getSelecteds().getLastElement();switch(jMap.layoutManager.type){case"jMindMapLayout":if(A.isRootNode()){}else{jMap.controller.prevSiblingNodeFocusAction(A)}break;case"jTreeLayout":jMap.controller.parentNodeFocusAction(A);break;default:}break;case 39:var A=jMap.getSelecteds().getLastElement();switch(jMap.layoutManager.type){case"jMindMapLayout":if(A.isRootNode()){var z=A.getChildren();for(var y=0;y<z.length;y++){if(z[y].position=="right"){z[y].focus(true);break}}}else{if(A.isLeft()){jMap.controller.parentNodeFocusAction(A)}else{jMap.controller.childNodeFocusAction(A)}}break;case"jTreeLayout":jMap.controller.nextSiblingNodefocusAction(A);break;default:}break;case 40:var A=jMap.getSelecteds().getLastElement();switch(jMap.layoutManager.type){case"jMindMapLayout":if(A.isRootNode()){}else{jMap.controller.nextSiblingNodefocusAction(A)}break;case"jTreeLayout":jMap.controller.childNodeFocusAction(A);break;default:}break}return false};return u})();